@page "/modernchat"
@rendermode InteractiveServer
@inject ChatEx.ViewModels.ChatExViewModel vm

<div class="chat-container">
    <div class="chat-area">
        <!-- å†å²èŠå¤©è®°å½• -->
        <div class="chat-history">
            @if (vm.HistoryMeesageList.Count > 0)
            {
                @foreach (var item in vm.HistoryMeesageList)
                {
                    <MessageCard Title="@item.Title" Content="@item.OutPutContent" />
                }
            }
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-wrapper">
            <div class="input-area">
                <textarea @bind="vm.Ques"
                          placeholder="è¯·è¾“å…¥æ‚¨çš„ç³»ç»Ÿpromptï¼Œå¦‚ï¼šæ‚¨æ¥æ‰®æ¼”æˆ‘çš„ç§äººåŠ©ç†..."
                          class="message-input"
                          @bind:event="oninput"></textarea>
                <button class="send-button" @onclick="SendQuestion">
                    <span class="send-icon">ğŸ“¤</span>
                </button>
            </div>
            <div class="saved-prompts">
                <span>å·²ä¿å­˜çš„prompt</span>
                <span class="dropdown-icon">â–¼</span>
            </div>
        </div>
    </div>

    <!-- å³ä¾§è®¾ç½®åŒºåŸŸ -->
    <div class="settings-area">
        <div class="model-info">
            <div class="model-header">
                <span class="model-name">4o-mini</span>
                <span class="clear-icon">âœ–</span>
            </div>
            
            <div class="knowledge-base">
                <div class="toggle-label">æ˜¯å¦ä½¿ç”¨çŸ¥è¯†åº“</div>
                <div class="toggle-wrapper">
                    <label class="toggle">
                        <input type="checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <button class="knowledge-manage-btn">çŸ¥è¯†åº“ç®¡ç†</button>
            </div>
            
            <div class="model-selection">
                <div class="selection-label">æ¨¡å‹é€‰æ‹©</div>
                <div class="selection-description">ç”¨äºæŒ‡å®šè¦ä½¿ç”¨çš„AIå¤§æ¨¡å‹</div>
                <div class="model-dropdown">
                    <div class="selected-model">
                        <span class="star-icon">â­</span>
                        <span>4o-mini</span>
                        <span class="dropdown-icon">â–¼</span>
                    </div>
                </div>
            </div>
            
            <div class="parameter-setting">
                <ModelParameter 
                    Label="æ–‡æœ¬å¤šæ ·æ€§" 
                    Value="1" 
                    Description="æ•°å€¼è¶Šå¤§æ–‡æœ¬å¤šæ ·æ€§ä¼šå¯¼è‡´éšæœºæ€§å¢åŠ çš„æ–‡æœ¬ï¼Œè€Œè¾ƒä½çš„æ–‡æœ¬å¤šæ ·æ€§ä¼šä½¿ç”Ÿæˆçš„æ–‡æœ¬æ›´åŠ ç¡®å®šæ€§ã€‚"
                    Min="0"
                    Max="2"
                    Step="0.1" />
                
                <ModelParameter 
                    Label="å›å¤æ–‡æœ¬æœ€å¤§é•¿åº¦" 
                    Value="0" 
                    Description="ç”¨äºé™åˆ¶ç”Ÿæˆçš„æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ï¼Œä»¥é¿å…ç”Ÿæˆè¿‡é•¿çš„å›å¤"
                    Min="0"
                    Max="2000"
                    Step="100" />
                
                <ModelParameter 
                    Label="åœæ­¢æ ‡è®°" 
                    Type="text" 
                    ShowValue="false"
                    Description="å½“æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬ä¸­åŒ…å«åœæ­¢æ ‡è®°æ—¶ï¼Œä¼šåœæ­¢ç”Ÿæˆä¸€æ­¥çš„æ–‡æœ¬ã€‚"
                    Placeholder="è¾“å…¥åœæ­¢æ ‡è®°" />
                
                <ModelParameter 
                    Label="è¯æ±‡èŒƒå›´" 
                    Value="0.6" 
                    Description="é€šè¿‡è®¾ç½®ä¸€ä¸ªå€¼é™åˆ¶æ¨¡å‹ä½¿ç”¨çš„è¯æ±‡æ¥æºçš„é™åˆ¶èŒƒå›´"
                    Min="0"
                    Max="1"
                    Step="0.1" />
                
                <ModelParameter 
                    Label="è¯æ±‡é‡å¤åº¦" 
                    Value="0" 
                    Description="é˜²æ­¢æ¨¡å‹è¾“å‡ºé‡å¤çš„å†…å®¹ï¼Œè¶Šé«˜è¶Šä¸ä¼šé‡å¤"
                    Min="0"
                    Max="1"
                    Step="0.1" />
            </div>
        </div>
    </div>
</div>

@code {
    private async Task SendQuestion()
    {
        await vm.SendQuestion();
    }

    protected override void OnInitialized()
    {
        // é€šçŸ¥æ›´æ–°UIäº‹ä»¶å¤„ç†å‡½æ•°
        vm.UpdateUIEventHandler += UpdateUI;
        vm.Declare();
    }

    // æ›´æ–°UI
    private async Task UpdateUI()
    {
        await InvokeAsync(() => StateHasChanged());
    }

    // é€šçŸ¥æ›´æ–°UIäº‹ä»¶å¤„ç†å‡½æ•°
    private async void UpdateUI(object sender, EventArgs e)
    {
        await InvokeAsync(() => StateHasChanged());
    }
} 